<html lang="en">
<head>
    <title>Yuka | Tic-Tac-Toe</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../../lib/styles.css">
</head>
<body>

<section>
    <input id="cell">
    <button id="submit">Submit</button>
</section>

<section id="boards">

</section>

<script type="module">

	import { TTTGraph } from './src/TTTGraph.js';

	const boardsUI = document.getElementById( 'boards' );
	const submitButton = document.getElementById( 'submit' );
	const cellInput = document.getElementById( 'cell' );

	let player, graph, fin = false;

	init();

	function init() {

	    player = parseInt( 1 );
    	graph = new TTTGraph( player );

		if ( player === 2 ) graph.aiTurn();

		print( graph.getNode( graph.currentNode ) );

		submitButton.addEventListener( 'click', function onClick() {

			const cell = cellInput.value;
			cellInput.value = '';

			graph.turn( cell, graph.currentPlayer );
			evaluate();

			if ( fin === false ) {

				graph.aiTurn();
				evaluate();

			}

			if ( fin === true ) {

                submitButton.removeEventListener( 'click', onClick );

            }

	} );

	}

	function evaluate() {

		const nextNode = graph.getNode( graph.currentNode );

		if ( nextNode.isWin ) {

			//check for win
			fin = true;
			alert( "Win Player: " + nextNode.winPlayer );

		}

		if ( nextNode.filled === 9 ) {

			//check for draw
			fin = true;
			alert( "It's a draw" );

		}

		print( nextNode );

}

	function print( node ) {

		const field = node.field;

		let s = "";

		for ( let i = 0; i < 3; i ++ ) {

			s = s + '[';

			for ( let j = 0; j < 3; j ++ ) {

				if ( field[ i * 3 + j ] === 9 ) {

					s = s + "_";

				} else {

					s = s + field[ i * 3 + j ];

				}

			}
			s = s + ']\n';

		}

		boardsUI.innerText = s;

	}

</script>

</body>
</html>
